# -*- coding: utf-8 -*-
"""Dataset_preparation.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1JI6OFAdnEvgK1iP1kwl7FQIggDurK1V3
"""

from google.colab import drive 
drive.mount ('/content/drive')

import pandas as pd 
from datetime import date, timedelta 
from random import randint

dataset= pd.read_csv ('/content/drive/MyDrive/Articles.csv', encoding='ISO-8859-1')

dataset.head()

# Adding three extra columns is_deadline, start, end

dataset['is_deadline']='' 
dataset['start']='' 
dataset['end']=''

dataset.head()

dataset.shape

today_date= date.today()

import re

# Lets say we will create 1600 positive samples and remaining are negative samples. We will randomly assign datetime in article column in the random records by using a loop.

# List of 10 different date-time format 
datetime_format= ['%m/%d/%Y', '%m/%d/%y', '%d/%m/%Y', '%d/%m/%y', '%d-%m-%Y', '%d-%m-%y', '%m-%d-%Y', '%m-%d-%y', '%Y-%m-%d', '%f/%e/%Y' ]

x= dataset['Article'].copy()

x.head()

import random 
number_sample_1= random.sample (range(2692), 1600) # these random numbers are index of the positive cases

number_sample_1

for i in range (len (number_sample_1)):
   
  index_of_data= number_sample_1[i] 
  article_data= x[index_of_data] 
  # adding/subtracting random timedelta 
  timedelta_number= randint (0,300) 
  random_timedelta= timedelta (timedelta_number)
  if i%2==0: 
    new_time= today_date+random_timedelta 
  else: 
    new_time= today_date-random_timedelta 
  # formatting datetime 
  date_value= randint (0,9) 
  datetime_string= new_time.strftime (datetime_format[date_value]) 
  # randomly select index from text  
  length= len (article_data) 
  value_str= randint (0, length) 
  # insert the formatted datetime string after selected index 
  split_string= article_data.split () 
  split_string.insert (value_str, datetime_string) 
  final_string=' '.join (split_string)  
  # replace the new string in dataframe 
  x[index_of_data]= final_string 
  # counting start and end 
  b= re.search (r'\d',final_string )
  start_time= b.start()
  end_time= start_time+len (datetime_string) 
  dataset['is_deadline'][index_of_data]=1 
  dataset['start'][index_of_data]= start_time 
  dataset['end'][index_of_data]= end_time

for i in range (len (x)): #assigning 0 to all negative samples 
  if i not in number_sample_1: 
    dataset['is_deadline'][i]=0 
    dataset['start'][i]=0 
    dataset['end'][i]=0

dataset['is_deadline'][1121] #Checking a random index

dataset.drop ('Article', axis=1, inplace=True)

dataset.head()

new_dataframe= pd.concat ([x,dataset], axis=1) #concatenating x and dataset

new_dataframe.head()

# Save it in a new csv file 
new_dataframe.to_csv ('New_dataset.csv', index=False)